<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFè©³ç´°åˆ†æãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .upload-area { border: 2px dashed #ccc; padding: 20px; text-align: center; margin: 20px 0; }
        .results { margin-top: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; white-space: pre-wrap; }
        .pattern-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .pattern-item { background: #f9f9f9; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ” PDFè©³ç´°åˆ†æãƒ†ã‚¹ãƒˆ</h1>
    <p>PDFãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°ãªåˆ†æã‚’è¡Œã„ã€ãªãœãƒ‘ãƒ¼ã‚µãƒ¼ãŒå¤±æ•—ã™ã‚‹ã‹ã‚’èª¿æŸ»ã—ã¾ã™ã€‚</p>
    
    <div class="upload-area">
        <input type="file" id="pdfFile" accept=".pdf" />
        <br><br>
        <button onclick="analyzePDF()">PDFåˆ†æå®Ÿè¡Œ</button>
    </div>
    
    <div id="results" class="results"></div>

    <script>
        async function analyzePDF() {
            const fileInput = document.getElementById('pdfFile');
            const resultsDiv = document.getElementById('results');
            
            if (!fileInput.files[0]) {
                alert('PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const file = fileInput.files[0];
            console.log('ğŸ” PDFåˆ†æé–‹å§‹:', file.name);
            
            resultsDiv.innerHTML = '<p>åˆ†æä¸­...</p>';
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                
                const response = await fetch('/api/debug-pdf-analysis', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                displayResults(result);
                
            } catch (error) {
                console.error('åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                resultsDiv.innerHTML = '<div class="error">åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message + '</div>';
            }
        }
        
        function displayResults(result) {
            const resultsDiv = document.getElementById('results');
            
            if (!result.success) {
                resultsDiv.innerHTML = '<div class="error">ã‚¨ãƒ©ãƒ¼: ' + result.error + '</div>';
                return;
            }
            
            const analysis = result.analysis;
            const parseResult = result.parseResult;
            
            resultsDiv.innerHTML = `
                <div class="section">
                    <h3>ğŸ“Š åŸºæœ¬æƒ…å ±</h3>
                    <ul>
                        <li>ãƒ†ã‚­ã‚¹ãƒˆé•·: ${analysis.textLength.toLocaleString()}æ–‡å­—</li>
                        <li>ç·è¡Œæ•°: ${analysis.totalLines.toLocaleString()}è¡Œ</li>
                        <li>æ—¥æœ¬èª: ${analysis.hasJapanese ? 'âœ… æ¤œå‡º' : 'âŒ æœªæ¤œå‡º'}</li>
                        <li>è‹±èª: ${analysis.hasEnglish ? 'âœ… æ¤œå‡º' : 'âŒ æœªæ¤œå‡º'}</li>
                        <li>æ•°å­—: ${analysis.hasNumbers ? 'âœ… æ¤œå‡º' : 'âŒ æœªæ¤œå‡º'}</li>
                    </ul>
                </div>
                
                <div class="section">
                    <h3>ğŸ” å•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º</h3>
                    <div class="pattern-grid">
                        <div class="pattern-item">
                            <strong>æ¨™æº–å½¢å¼ï¼ˆå•1, Q1ï¼‰</strong><br>
                            ${analysis.questionPatterns.standardQ}å€‹æ¤œå‡º
                        </div>
                        <div class="pattern-item">
                            <strong>ç•ªå·å½¢å¼ï¼ˆ1. 2.ï¼‰</strong><br>
                            ${analysis.questionPatterns.numberedQ}å€‹æ¤œå‡º
                        </div>
                        <div class="pattern-item">
                            <strong>æ¥é ­è¾å½¢å¼ï¼ˆç¬¬1å•ï¼‰</strong><br>
                            ${analysis.questionPatterns.prefixedQ}å€‹æ¤œå‡º
                        </div>
                        <div class="pattern-item">
                            <strong>No./# å½¢å¼</strong><br>
                            ${analysis.questionPatterns.noStyleQ}å€‹æ¤œå‡º
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>ğŸ“ é¸æŠè‚¢ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º</h3>
                    <div class="pattern-grid">
                        <div class="pattern-item">
                            <strong>æ•°å­—é¸æŠè‚¢ï¼ˆ1. 2.ï¼‰</strong><br>
                            ${analysis.choicePatterns.numbered}å€‹æ¤œå‡º
                        </div>
                        <div class="pattern-item">
                            <strong>ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆï¼ˆa. b.ï¼‰</strong><br>
                            ${analysis.choicePatterns.alphabetic}å€‹æ¤œå‡º
                        </div>
                        <div class="pattern-item">
                            <strong>ã²ã‚‰ãŒãªï¼ˆã‚¢. ã‚¤.ï¼‰</strong><br>
                            ${analysis.choicePatterns.hiragana}å€‹æ¤œå‡º
                        </div>
                        <div class="pattern-item">
                            <strong>æ‹¬å¼§å½¢å¼ï¼ˆ(1) (2)ï¼‰</strong><br>
                            ${analysis.choicePatterns.parenthesis}å€‹æ¤œå‡º
                        </div>
                        <div class="pattern-item">
                            <strong>ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆå½¢å¼</strong><br>
                            ${analysis.choicePatterns.indented}å€‹æ¤œå‡º
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>ğŸ¥ åŒ»ç™‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡º</h3>
                    <div class="pattern-grid">
                        <div class="pattern-item">
                            <strong>æ‚£è€…é–¢é€£</strong><br>
                            ${analysis.medicalKeywords.patients}å€‹æ¤œå‡º
                        </div>
                        <div class="pattern-item">
                            <strong>åŒ»ç™‚ä¸€èˆ¬</strong><br>
                            ${analysis.medicalKeywords.medical}å€‹æ¤œå‡º
                        </div>
                        <div class="pattern-item">
                            <strong>æ•‘æ€¥é–¢é€£</strong><br>
                            ${analysis.medicalKeywords.emergency}å€‹æ¤œå‡º
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>ğŸ¯ ãƒ‘ãƒ¼ã‚µãƒ¼çµæœ</h3>
                    <p><strong>æ¤œå‡ºã•ã‚ŒãŸå•é¡Œæ•°:</strong> ${parseResult.questionsFound}å•</p>
                    ${parseResult.questions.length > 0 ? `
                        <h4>æ¤œå‡ºã•ã‚ŒãŸå•é¡Œï¼ˆæœ€åˆã®3å•ï¼‰:</h4>
                        ${parseResult.questions.map((q, i) => `
                            <div style="margin: 10px 0; padding: 10px; background: #f0f8ff; border-radius: 5px;">
                                <strong>å•é¡Œ${q.questionNumber}:</strong> ${q.questionText}<br>
                                <strong>é¸æŠè‚¢æ•°:</strong> ${Object.keys(q.choices || {}).length}å€‹
                            </div>
                        `).join('')}
                    ` : '<p>å•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</p>'}
                </div>
                
                <div class="section">
                    <h3>ğŸ’¡ æ¨å¥¨å¯¾ç­–</h3>
                    <ul>
                        ${result.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="section">
                    <h3>ğŸ“„ æŠ½å‡ºãƒ†ã‚­ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«ï¼ˆæœ€åˆã®1000æ–‡å­—ï¼‰</h3>
                    <pre>${result.sampleText}</pre>
                </div>
                
                <div class="section">
                    <h3>ğŸ“‹ æœ€åˆã®50è¡Œ</h3>
                    <pre>${analysis.firstLines.join('\n')}</pre>
                </div>
            `;
        }
    </script>
</body>
</html>
